version: "3.3"

services:
  backend:
    build: 
      context: . # Utilisation du contexte racine
      dockerfile: ./backend/Dockerfile
    container_name: tp-backend
    ports:
      - "3000:3000"
    networks:
      - webnet
    depends_on:
      - database
    # ðŸš¨ CORRECTION ICI : Monter le volume de donnÃ©es PERSISTANTES pour le backend
    volumes:
      - data-volume:/app/database 
      
  frontend:
    build: ./frontend
    container_name: tp-frontend
    ports:
      - "8080:80"
    depends_on:
      - backend
    networks:
      - webnet
      
  database:
    build: 
      context: ./database
    container_name: tp-database
    # ðŸš¨ CORRECTION ICI : Monter le mÃªme volume nommÃ© que le backend
    volumes:
      - data-volume:/app/database 
    # Le script RUN sqlite3 mydb.sqlite < init.sql doit Ãªtre executÃ©
    # une fois la premiÃ¨re fois pour initialiser le volume nommÃ©.
    networks:
      - webnet

networks:
  webnet:

# ðŸš¨ AJOUT : DÃ©finition du volume nommÃ© pour partager les donnÃ©es SQLite
volumes:
  data-volume:
